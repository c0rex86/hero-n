# Руководство для контрибьюторов

Спасибо за интерес к Heroin. Ниже описаны правила и процессы, чтобы ваш вклад был быстрым и качественным.

## Быстрый старт

### Требования
- Go 1.22+
- Docker и Docker Compose
- protoc и плагины `protoc-gen-go`, `protoc-gen-go-grpc`
- Android Studio, JDK 17, Android SDK 34 (для Android частей)

### Поднятие окружения
```bash
# генерация gRPC stubs
./scripts/proto-gen.sh

# сборка сервера
go -C server build ./cmd/heroin-server

# запуск dev окружения (ipfs, сервер, мониторинг)
./scripts/dev-start.sh

# проверка health
curl http://localhost:8082/healthz
```

## Правила разработки

### Архитектура
- следуем чистой архитектуре, зависимости направлены внутрь, модули независимы
- конфигурация вместо хардкода, всё в `server/configs/*.yaml`
- ошибки с контекстом, логи структурированные, метрики на важных путях

### Стиль кода
- Go: `gofmt`, `go vet`, избегать глобальных состояний, явные контексты в I/O и RPC
- Kotlin: Kotlin style guide, Compose best practices, MVVM, DI через Hilt
- Имена осмысленные, без сокращений, функции и модули самодокументируемы

### Прото-схемы
- правим `shared/proto/**`, сохраняем обратную совместимость по v1
- добавляем новые поля как optional, не меняем семантику существующих
- после правок запускаем `./scripts/proto-gen.sh`, коммитим сгенерированный код в `server/internal/gen`

### Миграции БД
- новый файл `server/migrations/NNN_name.sql`
- миграции идемпотентны, учитывают существующие объекты
- не вносить breaking changes без процедуры миграции данных

### Тестирование
- минимум: юнит тесты для измененных пакетов + интеграционный тест, если затронут API/хранилище
- сервер: `go test ./...`
- Android: `./gradlew test`

### Безопасность
- не коммитить секреты и ключи, использовать переменные окружения и конфиги
- при работе с крипто не ослаблять параметры без обсуждения
- отчеты о уязвимостях направлять приватно, не в публичные ишью

### Процесс разработки
- ответвляемся от `main`, ветка `feat/<scope>`, `fix/<scope>`, `chore/<scope>`
- коммиты в стиле Conventional Commits: `feat: ...`, `fix: ...`, `docs: ...`
- PR небольшой и тематический, один логический блок изменений
- перед PR: обновить `STATUS.md` при необходимости, добавить записи в `ROADMAP.md` если меняется план

### Чеклист для Pull Request
- [ ] все тесты проходят локально
- [ ] сгенерированы и закоммичены protobuf stubs, если менялись proto
- [ ] миграции добавлены и проверены, если менялась БД
- [ ] обновлена документация: README/STATUS/ROADMAP при необходимости
- [ ] нет утечек секретов, конфигурация корректная
- [ ] lints и форматирование пройдены

## Задачи и метки
- `area/server`, `area/android`, `area/proto`, `area/devops`
- `type/feature`, `type/bug`, `type/refactor`, `type/docs`
- `prio/high`, `prio/normal`, `prio/low`

## Релизы
- SemVer: `MAJOR.MINOR.PATCH`
- changelog на каждую версию
- Docker image для сервера, APK сборка для Android

## Коммуникация
- ишью и PR в репозитории
- технические обсуждения в комментариях к PR, решения фиксируем в описании PR

## Полезные ссылки
- ТЗ: `docs/TZ.md`
- Дорожная карта: `ROADMAP.md`
- Статус: `STATUS.md`
- Пример конфига: `server/configs/config.example.yaml`
